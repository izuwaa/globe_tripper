poetry run python run.py
/home/jboy/globe_tripper/src/agents/dispatcher_agent.py:26: UserWarning: [GEMINI_VIA_LITELLM] gemini/gemini-2.5-flash: You are using Gemini via LiteLLM. For better performance, reliability, and access to latest features, consider using Gemini directly through ADK's native Gemini integration. Replace LiteLlm(model='gemini/gemini-2.5-flash') with Gemini(model='gemini-2.5-flash'). Set ADK_SUPPRESS_GEMINI_LITELLM_WARNINGS=true to suppress this warning.
  model=LiteLlm(model=f"{_agent_config.get('provider', '')}/{_agent_config.get('model', '')}"),
[STATE] VisaState after planning:
{
  "requirements": [],
  "overall_summary": null,
  "search_tasks": [],
  "search_results": [],
  "earliest_safe_departure_date": "2025-12-05"
}
[STATE] FlightState with pre-populated search_tasks and search_results (debug only, no flight API calls):
{
  "search_tasks": [
    {
      "task_id": "debug_LOS_LHR_0",
      "traveler_indexes": [
        0
      ],
      "origin_city": "LOS",
      "destination_city": "LHR",
      "original_departure_date": "2025-12-01",
      "original_return_date": "2025-12-20",
      "recommended_departure_date": "2025-12-05",
      "recommended_return_date": "2025-12-20",
      "visa_timeline_reason": null,
      "cabin_preference": "economy",
      "budget_mode": "economy",
      "flexibility_hint": null,
      "prompt": null,
      "purpose": "flight_options_lookup"
    },
    {
      "task_id": "debug_IAH_LHR_1",
      "traveler_indexes": [
        1,
        2,
        3
      ],
      "origin_city": "IAH",
      "destination_city": "LHR",
      "original_departure_date": "2025-12-01",
      "original_return_date": "2025-12-20",
      "recommended_departure_date": "2025-12-05",
      "recommended_return_date": "2025-12-20",
      "visa_timeline_reason": null,
      "cabin_preference": "economy",
      "budget_mode": "economy",
      "flexibility_hint": null,
      "prompt": null,
      "purpose": "flight_options_lookup"
    }
  ],
  "search_results": [
    {
      "task_id": "debug_LOS_LHR_0",
      "query": "Debug LOS-LHR sample",
      "options": [
        {
          "option_type": "cheapest",
          "airlines": [
            "SampleAir LOS-LHR"
          ],
          "currency": "USD",
          "price_per_ticket_low": null,
          "price_per_ticket_high": null,
          "total_price_low": null,
          "total_price_high": null,
          "outbound_departure": null,
          "outbound_arrival": null,
          "return_departure": null,
          "return_arrival": null,
          "outbound_duration_hours": null,
          "return_duration_hours": null,
          "total_outbound_duration_minutes": null,
          "total_return_duration_minutes": null,
          "total_trip_duration_minutes": null,
          "outbound_stops": null,
          "return_stops": null,
          "notes": null
        },
        {
          "option_type": "fastest",
          "airlines": [
            "FastAir LOS-LHR"
          ],
          "currency": "USD",
          "price_per_ticket_low": null,
          "price_per_ticket_high": null,
          "total_price_low": null,
          "total_price_high": null,
          "outbound_departure": null,
          "outbound_arrival": null,
          "return_departure": null,
          "return_arrival": null,
          "outbound_duration_hours": null,
          "return_duration_hours": null,
          "total_outbound_duration_minutes": null,
          "total_return_duration_minutes": null,
          "total_trip_duration_minutes": null,
          "outbound_stops": null,
          "return_stops": null,
          "notes": null
        }
      ],
      "summary": "Sample LOS-LHR options for debugging.",
      "best_price_hint": "~$1000–$1200 per ticket",
      "best_time_hint": "Fastest option is non-stop with FastAir.",
      "cheap_but_long_hint": "Cheapest option has one stop and longer duration.",
      "recommended_option_label": "FastAir LOS-LHR (fastest)",
      "notes": "Debug sample only; not from live API.",
      "chosen_option_type": "balanced",
      "selection_reason": "Balanced option trades off price and time."
    },
    {
      "task_id": "debug_IAH_LHR_1",
      "query": "Debug IAH-LHR sample",
      "options": [
        {
          "option_type": "cheapest",
          "airlines": [
            "SampleAir IAH-LHR"
          ],
          "currency": "USD",
          "price_per_ticket_low": null,
          "price_per_ticket_high": null,
          "total_price_low": null,
          "total_price_high": null,
          "outbound_departure": null,
          "outbound_arrival": null,
          "return_departure": null,
          "return_arrival": null,
          "outbound_duration_hours": null,
          "return_duration_hours": null,
          "total_outbound_duration_minutes": null,
          "total_return_duration_minutes": null,
          "total_trip_duration_minutes": null,
          "outbound_stops": null,
          "return_stops": null,
          "notes": null
        },
        {
          "option_type": "fastest",
          "airlines": [
            "FastAir IAH-LHR"
          ],
          "currency": "USD",
          "price_per_ticket_low": null,
          "price_per_ticket_high": null,
          "total_price_low": null,
          "total_price_high": null,
          "outbound_departure": null,
          "outbound_arrival": null,
          "return_departure": null,
          "return_arrival": null,
          "outbound_duration_hours": null,
          "return_duration_hours": null,
          "total_outbound_duration_minutes": null,
          "total_return_duration_minutes": null,
          "total_trip_duration_minutes": null,
          "outbound_stops": null,
          "return_stops": null,
          "notes": null
        }
      ],
      "summary": "Sample IAH-LHR options for debugging.",
      "best_price_hint": "~$900–$1100 per ticket",
      "best_time_hint": "Fastest option is non-stop with FastAir.",
      "cheap_but_long_hint": "Cheapest option has one stop and longer duration.",
      "recommended_option_label": "SampleAir / FastAir IAH-LHR (balanced)",
      "notes": "Debug sample only; not from live API.",
      "chosen_option_type": "balanced",
      "selection_reason": "Balanced option trades off price and time."
    }
  ],
  "overall_summary": null,
  "traveler_flights": []
}
[PLANNER] Running accommodation_agent to derive accommodation search tasks...
Warning: there are non-text parts in the response: ['function_call'], returning concatenated text result from text parts. Check the full candidates.content.parts accessor to get the full model response.
[Tool] derive_accommodation_search_tasks created 1 accommodation task for destination=London, UK travelers=[0, 1, 2, 3]
[PLANNER] Final reply from accommodation_agent:
I have prepared accommodation search tasks for your trip to London, UK. The check-in date is December 1, 2025, and the check-out date is December 20, 2025.

The tasks prioritize family-friendly apartments and 4-star hotels in safe, central neighborhoods near parks, while avoiding party areas. The accommodation should be suitable for 2 adults and 2 young children (ages 3 and 5), with a preference for a single property or rooms within the same building.
[STATE] AccommodationState after planning (search_tasks derived):
{
  "search_tasks": [
    {
      "task_id": "accommodation_0",
      "traveler_indexes": [
        0,
        1,
        2,
        3
      ],
      "location": "London, UK",
      "check_in_date": "2025-12-01",
      "check_out_date": "2025-12-20",
      "budget_mode": "standard",
      "preferred_types": [
        "family-friendly apartment",
        "4-star hotel"
      ],
      "neighborhood_preferences": [
        "safe",
        "central",
        "near parks"
      ],
      "neighborhood_avoid": [
        "party areas",
        "noisy nightlife"
      ],
      "room_configuration": "2 adults and 2 young children in one family room or two connecting rooms",
      "special_requirements": [],
      "prompt": "Search for suitable accommodation options for the following trip context:\n- Destination: London, UK\n- Check-in date: 2025-12-01\n- Check-out date: 2025-12-20\n- Budget mode: standard\n- Travelers covered (indexes): [0, 1, 2, 3]\n- Number of adults: 2\n- Child ages (if any): [3, 5]\n- Preferred stay types: ['family-friendly apartment', '4-star hotel']\n- Room configuration: 2 adults and 2 young children in one family room or two connecting rooms\n- Neighborhoods to prioritize: ['safe', 'central', 'near parks']\n- Neighborhoods to avoid: ['party areas', 'noisy nightlife']\n- Grouping intent: the travelers listed above form one traveling party. Prefer a single property that can host the whole group. If that is not practical, keep them in the same property (for example multiple rooms in one hotel or multiple units in one building) and briefly explain the grouping in your summary.\n- Important: the youngest child is 3 years old; do NOT assign children to rooms without at least one adult present.",
      "purpose": "accommodation_options_lookup"
    }
  ],
  "search_results": [],
  "overall_summary": null,
  "traveler_accommodations": []
}
[PLANNER] Running accommodation search pipeline...
[ACCOM-SEARCH] Found 1 pending AccommodationSearchTask(s)
Event from an unknown agent: accommodation_agent, event id: 888f500f-a783-4516-bc4b-a2b90f889a1b
Event from an unknown agent: accommodation_agent, event id: d7ceedb0-cdeb-4188-aa00-dc59260fd330
Event from an unknown agent: accommodation_agent, event id: b08be7ea-c424-430f-957b-bbfc7bd79b94
Event from an unknown agent: accommodation_search_tool_agent, event id: 276f506d-461f-4d10-a589-f76f5c67df47
Event from an unknown agent: accommodation_search_tool_agent, event id: ecdbb43a-58cd-4e27-b20a-8a20027b08b4
Event from an unknown agent: accommodation_agent, event id: 888f500f-a783-4516-bc4b-a2b90f889a1b
Event from an unknown agent: accommodation_agent, event id: d7ceedb0-cdeb-4188-aa00-dc59260fd330
Event from an unknown agent: accommodation_agent, event id: b08be7ea-c424-430f-957b-bbfc7bd79b94
[Accommodation Result Tool] Recorded AccommodationSearchResult for task_id=accommodation_0
[STATE] AccommodationState after accommodation search phase (search_results populated):
{
  "search_tasks": [
    {
      "task_id": "accommodation_0",
      "traveler_indexes": [
        0,
        1,
        2,
        3
      ],
      "location": "London, UK",
      "check_in_date": "2025-12-01",
      "check_out_date": "2025-12-20",
      "budget_mode": "standard",
      "preferred_types": [
        "family-friendly apartment",
        "4-star hotel"
      ],
      "neighborhood_preferences": [
        "safe",
        "central",
        "near parks"
      ],
      "neighborhood_avoid": [
        "party areas",
        "noisy nightlife"
      ],
      "room_configuration": "2 adults and 2 young children in one family room or two connecting rooms",
      "special_requirements": [],
      "prompt": "Search for suitable accommodation options for the following trip context:\n- Destination: London, UK\n- Check-in date: 2025-12-01\n- Check-out date: 2025-12-20\n- Budget mode: standard\n- Travelers covered (indexes): [0, 1, 2, 3]\n- Number of adults: 2\n- Child ages (if any): [3, 5]\n- Preferred stay types: ['family-friendly apartment', '4-star hotel']\n- Room configuration: 2 adults and 2 young children in one family room or two connecting rooms\n- Neighborhoods to prioritize: ['safe', 'central', 'near parks']\n- Neighborhoods to avoid: ['party areas', 'noisy nightlife']\n- Grouping intent: the travelers listed above form one traveling party. Prefer a single property that can host the whole group. If that is not practical, keep them in the same property (for example multiple rooms in one hotel or multiple units in one building) and briefly explain the grouping in your summary.\n- Important: the youngest child is 3 years old; do NOT assign children to rooms without at least one adult present.",
      "purpose": "accommodation_options_lookup"
    }
  ],
  "search_results": [],
  "overall_summary": null,
  "traveler_accommodations": []
}
[ACCOM-APPLY] Running accommodation_apply_agent to apply accommodation search results...
Event from an unknown agent: accommodation_search_agent, event id: 8d8f6643-47c1-4c89-8440-061e9d2bbbbb
Event from an unknown agent: accommodation_search_tool_agent, event id: 276f506d-461f-4d10-a589-f76f5c67df47
Event from an unknown agent: accommodation_search_tool_agent, event id: ecdbb43a-58cd-4e27-b20a-8a20027b08b4
Event from an unknown agent: accommodation_agent, event id: 888f500f-a783-4516-bc4b-a2b90f889a1b
Event from an unknown agent: accommodation_agent, event id: d7ceedb0-cdeb-4188-aa00-dc59260fd330
Event from an unknown agent: accommodation_agent, event id: b08be7ea-c424-430f-957b-bbfc7bd79b94
[ACCOM-APPLY] accommodation_apply_agent final reply:
None
[ACCOM-APPLY] accommodation_apply_agent final reply:
None
[ACCOM-APPLY] accommodation_apply_agent final reply:
I have applied the accommodation search results. 1 accommodation search result was processed.
[STATE] AccommodationState after apply_accommodation_search_results:
{
  "search_tasks": [
    {
      "task_id": "accommodation_0",
      "traveler_indexes": [
        0,
        1,
        2,
        3
      ],
      "location": "London, UK",
      "check_in_date": "2025-12-01",
      "check_out_date": "2025-12-20",
      "budget_mode": "standard",
      "preferred_types": [
        "family-friendly apartment",
        "4-star hotel"
      ],
      "neighborhood_preferences": [
        "safe",
        "central",
        "near parks"
      ],
      "neighborhood_avoid": [
        "party areas",
        "noisy nightlife"
      ],
      "room_configuration": "2 adults and 2 young children in one family room or two connecting rooms",
      "special_requirements": [],
      "prompt": "Search for suitable accommodation options for the following trip context:\n- Destination: London, UK\n- Check-in date: 2025-12-01\n- Check-out date: 2025-12-20\n- Budget mode: standard\n- Travelers covered (indexes): [0, 1, 2, 3]\n- Number of adults: 2\n- Child ages (if any): [3, 5]\n- Preferred stay types: ['family-friendly apartment', '4-star hotel']\n- Room configuration: 2 adults and 2 young children in one family room or two connecting rooms\n- Neighborhoods to prioritize: ['safe', 'central', 'near parks']\n- Neighborhoods to avoid: ['party areas', 'noisy nightlife']\n- Grouping intent: the travelers listed above form one traveling party. Prefer a single property that can host the whole group. If that is not practical, keep them in the same property (for example multiple rooms in one hotel or multiple units in one building) and briefly explain the grouping in your summary.\n- Important: the youngest child is 3 years old; do NOT assign children to rooms without at least one adult present.",
      "purpose": "accommodation_options_lookup"
    }
  ],
  "search_results": [],
  "overall_summary": null,
  "traveler_accommodations": []
}